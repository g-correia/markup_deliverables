<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.5.57">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>report_code</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="02_report_code_files/libs/clipboard/clipboard.min.js"></script>
<script src="02_report_code_files/libs/quarto-html/quarto.js"></script>
<script src="02_report_code_files/libs/quarto-html/popper.min.js"></script>
<script src="02_report_code_files/libs/quarto-html/tippy.umd.min.js"></script>
<script src="02_report_code_files/libs/quarto-html/anchor.min.js"></script>
<link href="02_report_code_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="02_report_code_files/libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="02_report_code_files/libs/bootstrap/bootstrap.min.js"></script>
<link href="02_report_code_files/libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="02_report_code_files/libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">


</head>

<body class="fullcontent">

<div id="quarto-content" class="page-columns page-rows-contents page-layout-article">

<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">report_code</h1>
</div>



<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>Gabriela Correia, Zhipei Wang </p>
          </div>
  </div>
    
  
    
  </div>
  


</header>


<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="co"># loading packages</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggdendro)</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(patchwork)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: package 'patchwork' was built under R version 4.3.3</code></pre>
</div>
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(sparcl)</span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(factoextra)</span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(caret)</span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(fpc)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: package 'fpc' was built under R version 4.3.3</code></pre>
</div>
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(cluster)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="co"># read in the data (the training set only)</span></span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a>df <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="st">"../raw_data/training_obsolete.csv"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="co"># take a glimpse</span></span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(df)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>      class BrdIndx Area Round Bright Compact ShpIndx Mean_G Mean_R Mean_NIR
1      car     1.27   91  0.97 231.38    1.39    1.47 207.92 241.74   244.48
2 concrete     2.36  241  1.56 216.15    2.46    2.51 187.85 229.39   231.20
3 concrete     2.12  266  1.47 232.18    2.07    2.21 206.54 244.22   245.79
4 concrete     2.42  399  1.28 230.40    2.49    2.73 204.60 243.27   243.32
5 concrete     2.15  944  1.73 193.18    2.28    4.10 165.98 205.55   208.00
6     tree     3.11  169  1.47 172.22    2.49    3.35 240.18 127.65   148.83
   SD_G  SD_R SD_NIR    LW GLCM1 Rect GLCM2 Dens Assym  NDVI BordLngth   GLCM3
1 21.41 20.40  18.69  2.19  0.48 0.87  6.23 1.60  0.74 -0.08        56 4219.69
2  6.57  6.97   7.02  1.52  0.45 0.63  6.35 1.55  0.69 -0.10       156 3682.08
3  6.16  4.93   5.53  1.14  0.52 0.78  6.19 1.88  0.19 -0.08       144 2943.35
4  5.76  5.56   5.46  2.51  0.50 0.74  6.28 1.51  0.83 -0.09       218 3550.19
5 11.46  8.90   9.77 12.26  0.71 0.59  7.36 0.63  0.99 -0.11       504 2300.41
6  8.41 10.34  11.50  1.87  0.43 0.55  6.44 1.38  0.70  0.31       174 4707.12
  BrdIndx_40 Area_40 Round_40 Bright_40 Compact_40 ShpIndx_40 Mean_G_40
1       1.33      97     1.12    227.19       1.32       1.42    203.95
2       3.01    1188     1.45    209.44       2.25       3.54    181.91
3       2.32    1095     1.50    232.50       1.93       2.55    208.36
4       3.16    4009     2.28    231.57       3.48       3.47    204.77
5       2.15     944     1.73    193.18       2.28       4.10    165.98
6       3.25     747     1.55    161.30       2.53       3.33    228.44
  Mean_R_40 Mean_NIR_40 SD_G_40 SD_R_40 SD_NIR_40 LW_40 GLCM1_40 Rect_40
1    237.23      240.38   27.63   28.36     26.18  2.00     0.50    0.85
2    222.46      223.95    9.82   10.37     10.51  2.97     0.63    0.65
3    244.07      245.08    6.55    7.01      6.83  2.19     0.49    0.74
4    245.17      244.76    9.55    9.35      9.34  2.27     0.63    0.62
5    205.55      208.00   11.46    8.90      9.77 12.26     0.71    0.59
6    117.25      138.20   16.32   14.66     15.47  1.02     0.74    0.69
  GLCM2_40 Dens_40 Assym_40 NDVI_40 BordLngth_40 GLCM3_40 BrdIndx_60 Area_60
1     6.29    1.67     0.70   -0.08           56  3806.36       1.33      97
2     7.16    1.43     0.83   -0.10          488  2581.63       4.53    3861
3     6.51    1.61     0.81   -0.08          338  3087.91       2.05    4368
4     7.04    1.32     0.84   -0.09          878  2194.40       3.26    4834
5     7.36    0.63     0.99   -0.11          504  2300.41       2.08    3026
6     7.54    1.81     0.55    0.32          364  1764.09       1.88    1318
  Round_60 Bright_60 Compact_60 ShpIndx_60 Mean_G_60 Mean_R_60 Mean_NIR_60
1     1.12    227.19       1.32       1.42    203.95    237.23      240.38
2     1.96    207.24       3.00       4.70    180.61    219.54      221.58
3     1.27    224.42       1.98       2.22    202.85    234.48      235.94
4     2.04    231.28       2.89       3.56    205.87    244.14      243.82
5     1.97    202.17       2.52       3.94    181.47    211.90      213.15
6     1.00    162.91       1.93       1.91    224.17    121.94      142.62
  SD_G_60 SD_R_60 SD_NIR_60 LW_60 GLCM1_60 Rect_60 GLCM2_60 Dens_60 Assym_60
1   27.63   28.36     26.18  2.00     0.50    0.85     6.29    1.67     0.70
2   18.98   19.62     19.38  1.64     0.70    0.50     8.04    1.47     0.45
3   13.07   13.26     12.99  2.19     0.75    0.71     7.16    1.61     0.82
4   12.02   10.36     10.25  2.26     0.69    0.65     7.19    1.51     0.77
5   16.86   13.90     14.43 12.07     0.87    0.69     7.90    0.68     1.00
6   22.66   19.62     20.41  1.06     0.84    0.82     7.90    2.05     0.55
  NDVI_60 BordLngth_60 GLCM3_60 BrdIndx_80 Area_80 Round_80 Bright_80
1   -0.08           56  3806.36       1.33      97     1.12    227.19
2   -0.10         1168  1877.18       4.68    5544     1.93    205.53
3   -0.07          586  1245.19       2.05    4368     1.27    224.42
4   -0.09          990  1718.90       3.50    7622     1.91    232.09
5   -0.08          866   965.85       2.53    8862     2.10    196.33
6    0.30          278  1058.38       4.15    2517     1.97    161.02
  Compact_80 ShpIndx_80 Mean_G_80 Mean_R_80 Mean_NIR_80 SD_G_80 SD_R_80
1       1.32       1.42    203.95    237.23      240.38   27.63   28.36
2       3.17       5.12    178.89    217.71      220.01   18.86   19.94
3       1.98       2.22    202.85    234.48      235.94   13.07   13.26
4       2.83       4.19    205.48    245.53      245.26   10.44    9.36
5       2.89       6.57    180.56    203.81      204.62   16.01   16.50
6       2.88       4.39    222.03    120.40      140.62   23.37   22.87
  SD_NIR_80 LW_80 GLCM1_80 Rect_80 GLCM2_80 Dens_80 Assym_80 NDVI_80
1     26.18  2.00     0.50    0.85     6.29    1.67     0.70   -0.08
2     19.61  2.26     0.74    0.48     8.14    1.28     0.78   -0.10
3     12.99  2.19     0.75    0.71     7.16    1.61     0.82   -0.07
4      9.35  3.38     0.67    0.62     7.01    1.16     0.93   -0.09
5     17.48 24.83     0.84    0.59     7.97    0.43     1.00   -0.06
6     23.51  1.89     0.81    0.62     8.19    1.50     0.71    0.30
  BordLngth_80 GLCM3_80 BrdIndx_100 Area_100 Round_100 Bright_100 Compact_100
1           56  3806.36        1.33       97      1.12     227.19        1.32
2         1526  1757.87        4.68     5544      1.93     205.53        3.17
3          586  1245.19        1.93     4606      1.17     222.97        1.87
4         1464  1785.12        3.50     7622      1.91     232.09        2.83
5         2474  1130.22        2.53     8862      2.10     196.33        2.89
6          880  1333.10        3.05     4174      1.50     161.92        2.00
  ShpIndx_100 Mean_G_100 Mean_R_100 Mean_NIR_100 SD_G_100 SD_R_100 SD_NIR_100
1        1.42     203.95     237.23       240.38    27.63    28.36      26.18
2        5.12     178.89     217.71       220.01    18.86    19.94      19.61
3        2.08     201.51     232.96       234.43    15.35    15.93      15.59
4        4.19     205.48     245.53       245.26    10.44     9.36       9.35
5        6.57     180.56     203.81       204.62    16.01    16.50      17.48
6        3.35     222.62     121.92       141.23    29.25    26.42      26.38
  LW_100 GLCM1_100 Rect_100 GLCM2_100 Dens_100 Assym_100 NDVI_100 BordLngth_100
1   2.00      0.50     0.85      6.29     1.67      0.70    -0.08            56
2   2.26      0.74     0.48      8.14     1.28      0.78    -0.10          1526
3   2.19      0.76     0.74      7.24     1.68      0.81    -0.07           566
4   3.38      0.67     0.62      7.01     1.16      0.93    -0.09          1464
5  24.83      0.84     0.59      7.97     0.43      1.00    -0.06          2474
6   2.31      0.84     0.79      8.17     1.80      0.68     0.29           866
  GLCM3_100 BrdIndx_120 Area_120 Round_120 Bright_120 Compact_120 ShpIndx_120
1   3806.36        1.33       97      1.12     227.19        1.32        1.42
2   1757.87        4.57     7711      1.66     211.94        2.90        4.97
3   1094.04        1.93     4606      1.17     222.97        1.87        2.08
4   1785.12        2.41    10482      1.41     226.65        2.06        2.88
5   1130.22        3.34    16680      2.37     193.39        5.03       12.06
6    943.96        3.05     4174      1.50     161.92        2.00        3.35
  Mean_G_120 Mean_R_120 Mean_NIR_120 SD_G_120 SD_R_120 SD_NIR_120 LW_120
1     203.95     237.23       240.38    27.63    28.36      26.18   2.00
2     186.31     223.83       225.68    22.62    22.92      22.29   2.25
3     201.51     232.96       234.43    15.35    15.93      15.59   2.19
4     200.18     239.93       239.83    13.69    13.75      13.51   3.34
5     172.13     203.14       204.91    17.38    14.93      15.65  50.08
6     222.62     121.92       141.23    29.25    26.42      26.38   2.31
  GLCM1_120 Rect_120 GLCM2_120 Dens_120 Assym_120 NDVI_120 BordLngth_120
1      0.50     0.85      6.29     1.67      0.70    -0.08            56
2      0.79     0.55      8.42     1.38      0.81    -0.09          1746
3      0.76     0.74      7.24     1.68      0.81    -0.07           566
4      0.82     0.74      7.44     1.36      0.92    -0.09          1178
5      0.85     0.49      8.15     0.23      1.00    -0.08          6232
6      0.84     0.79      8.17     1.80      0.68     0.29           866
  GLCM3_120 BrdIndx_140 Area_140 Round_140 Bright_140 Compact_140 ShpIndx_140
1   3806.36        1.33       97      1.12     227.19        1.32        1.42
2   1450.14        4.57     7711      1.66     211.94        2.90        4.97
3   1094.04        1.93     4606      1.17     222.97        1.87        2.08
4   1125.38        2.41    10482      1.41     226.65        2.06        2.88
5   1146.38        3.34    16680      2.37     193.39        5.03       12.06
6    943.96        3.05     4174      1.50     161.92        2.00        3.35
  Mean_G_140 Mean_R_140 Mean_NIR_140 SD_G_140 SD_R_140 SD_NIR_140 LW_140
1     203.95     237.23       240.38    27.63    28.36      26.18   2.00
2     186.31     223.83       225.68    22.62    22.92      22.29   2.25
3     201.51     232.96       234.43    15.35    15.93      15.59   2.19
4     200.18     239.93       239.83    13.69    13.75      13.51   3.34
5     172.13     203.14       204.91    17.38    14.93      15.65  50.08
6     222.62     121.92       141.23    29.25    26.42      26.38   2.31
  GLCM1_140 Rect_140 GLCM2_140 Dens_140 Assym_140 NDVI_140 BordLngth_140
1      0.50     0.85      6.29     1.67      0.70    -0.08            56
2      0.79     0.55      8.42     1.38      0.81    -0.09          1746
3      0.76     0.74      7.24     1.68      0.81    -0.07           566
4      0.82     0.74      7.44     1.36      0.92    -0.09          1178
5      0.85     0.49      8.15     0.23      1.00    -0.08          6232
6      0.84     0.79      8.17     1.80      0.68     0.29           866
  GLCM3_140
1   3806.36
2   1450.14
3   1094.04
4   1125.38
5   1146.38
6    943.96</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="co"># remove the class column and standardize the data</span></span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>df_unsupervised <span class="ot">&lt;-</span> df[, <span class="sc">-</span><span class="dv">1</span>]</span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a>df_unsupervised <span class="ot">&lt;-</span> <span class="fu">scale</span>(df_unsupervised)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<section id="hierarchical-clustering" class="level1">
<h1>hierarchical clustering</h1>
<div class="cell">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="co"># set the seed for reproducibility</span></span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">123</span>)</span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a><span class="co"># hierarchical clustering with euclidean distance and complete linkage</span></span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a>distances_hc_eucl <span class="ot">&lt;-</span> <span class="fu">dist</span>(df_unsupervised, <span class="at">method =</span> <span class="st">"euclidean"</span>)</span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a>result_hc_eucl_comp <span class="ot">&lt;-</span> <span class="fu">hclust</span>(distances_hc_eucl, <span class="at">method =</span> <span class="st">"complete"</span>)</span>
<span id="cb10-7"><a href="#cb10-7" aria-hidden="true" tabindex="-1"></a><span class="fu">ggdendrogram</span>(result_hc_eucl_comp, <span class="at">labels =</span> <span class="cn">FALSE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="02_report_code_files/figure-html/unnamed-chunk-5-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="co"># save the clustering result as a factor</span></span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a>clus_hc_eucl_comp <span class="ot">&lt;-</span> <span class="fu">as.factor</span>(<span class="fu">cutree</span>(result_hc_eucl_comp, <span class="dv">9</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<section id="evaluating-cluster-results" class="level2">
<h2 class="anchored" data-anchor-id="evaluating-cluster-results">Evaluating cluster results</h2>
<section id="bootstrap-stability" class="level3">
<h3 class="anchored" data-anchor-id="bootstrap-stability">Bootstrap stability</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a>cboot_hc <span class="ot">&lt;-</span> <span class="fu">clusterboot</span>(df_unsupervised, <span class="at">clustermethod =</span> hclustCBI, <span class="at">method =</span> <span class="st">"complete"</span>, <span class="at">k =</span> <span class="dv">9</span>, <span class="at">seed =</span> <span class="dv">123</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>boot 1 
boot 2 
boot 3 
boot 4 
boot 5 
boot 6 
boot 7 
boot 8 
boot 9 
boot 10 
boot 11 
boot 12 
boot 13 
boot 14 
boot 15 
boot 16 
boot 17 
boot 18 
boot 19 
boot 20 
boot 21 
boot 22 
boot 23 
boot 24 
boot 25 
boot 26 
boot 27 
boot 28 
boot 29 
boot 30 
boot 31 
boot 32 
boot 33 
boot 34 
boot 35 
boot 36 
boot 37 
boot 38 
boot 39 
boot 40 
boot 41 
boot 42 
boot 43 
boot 44 
boot 45 
boot 46 
boot 47 
boot 48 
boot 49 
boot 50 
boot 51 
boot 52 
boot 53 
boot 54 
boot 55 
boot 56 
boot 57 
boot 58 
boot 59 
boot 60 
boot 61 
boot 62 
boot 63 
boot 64 
boot 65 
boot 66 
boot 67 
boot 68 
boot 69 
boot 70 
boot 71 
boot 72 
boot 73 
boot 74 
boot 75 
boot 76 
boot 77 
boot 78 
boot 79 
boot 80 
boot 81 
boot 82 
boot 83 
boot 84 
boot 85 
boot 86 
boot 87 
boot 88 
boot 89 
boot 90 
boot 91 
boot 92 
boot 93 
boot 94 
boot 95 
boot 96 
boot 97 
boot 98 
boot 99 
boot 100 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="co"># the vector of cluster stabilities</span></span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a>cboot_hc<span class="sc">$</span>bootmean</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.6278881 0.6181060 0.6751502 0.5847411 0.6521341 0.5188992 0.7961931
[8] 0.5122619 0.4367143</code></pre>
</div>
</div>
<p>Values close to 1 indicate stable clusters, so the first 3, fifth and seventh clusters have relatively higher stability.</p>
</section>
<section id="external-validity" class="level3">
<h3 class="anchored" data-anchor-id="external-validity">External validity</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a>df_labels <span class="ot">&lt;-</span> df</span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a>df_labels<span class="sc">$</span>cluster_hc_eucl_comp <span class="ot">&lt;-</span> clus_hc_eucl_comp  <span class="co"># Add cluster assignments to the original dataset</span></span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Count the number of occurrences of each class within each cluster</span></span>
<span id="cb16-5"><a href="#cb16-5" aria-hidden="true" tabindex="-1"></a>cluster_hc_eucl_comp_mapping <span class="ot">&lt;-</span> df_labels <span class="sc">%&gt;%</span></span>
<span id="cb16-6"><a href="#cb16-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(cluster_hc_eucl_comp, class) <span class="sc">%&gt;%</span></span>
<span id="cb16-7"><a href="#cb16-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">count =</span> <span class="fu">n</span>(), <span class="at">.groups =</span> <span class="st">"drop"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb16-8"><a href="#cb16-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(cluster_hc_eucl_comp, <span class="fu">desc</span>(count))  <span class="co"># Ensure sorting by most frequent class</span></span>
<span id="cb16-9"><a href="#cb16-9" aria-hidden="true" tabindex="-1"></a>cluster_hc_eucl_comp_mapping</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 27 × 3
   cluster_hc_eucl_comp class       count
   &lt;fct&gt;                &lt;chr&gt;       &lt;int&gt;
 1 1                    "building "    18
 2 1                    "car "          4
 3 1                    "concrete "     2
 4 1                    "grass "        1
 5 1                    "pool "         1
 6 2                    "concrete "    17
 7 2                    "soil "        13
 8 2                    "grass "        5
 9 2                    "building "     1
10 2                    "tree "         1
# ℹ 17 more rows</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Select the most frequent class for each cluster</span></span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a>cluster_hc_eucl_comp_lookup <span class="ot">&lt;-</span> cluster_hc_eucl_comp_mapping <span class="sc">%&gt;%</span></span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(cluster_hc_eucl_comp) <span class="sc">%&gt;%</span></span>
<span id="cb18-4"><a href="#cb18-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(count <span class="sc">==</span> <span class="fu">max</span>(count)) <span class="sc">%&gt;%</span>  <span class="co"># Select the most frequent class</span></span>
<span id="cb18-5"><a href="#cb18-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span></span>
<span id="cb18-6"><a href="#cb18-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(cluster_hc_eucl_comp, class)  <span class="co"># Keep only cluster-class mapping</span></span>
<span id="cb18-7"><a href="#cb18-7" aria-hidden="true" tabindex="-1"></a>cluster_hc_eucl_comp_lookup</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 9 × 2
  cluster_hc_eucl_comp class      
  &lt;fct&gt;                &lt;chr&gt;      
1 1                    "building "
2 2                    "concrete "
3 3                    "concrete "
4 4                    "grass "   
5 5                    "car "     
6 6                    "asphalt " 
7 7                    "pool "    
8 8                    "concrete "
9 9                    "concrete "</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Join the mapping back to the original dataset</span></span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a>df_labels <span class="ot">&lt;-</span> df_labels <span class="sc">%&gt;%</span></span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(cluster_hc_eucl_comp_lookup, <span class="at">by =</span> <span class="st">"cluster_hc_eucl_comp"</span>, , <span class="at">suffix =</span> <span class="fu">c</span>(<span class="st">""</span>, <span class="st">"_pred_hc_eucl_comp"</span>))</span>
<span id="cb20-4"><a href="#cb20-4" aria-hidden="true" tabindex="-1"></a>df_labels<span class="sc">$</span>class <span class="ot">&lt;-</span> <span class="fu">as.factor</span>(df_labels<span class="sc">$</span>class)</span>
<span id="cb20-5"><a href="#cb20-5" aria-hidden="true" tabindex="-1"></a>df_labels<span class="sc">$</span>class_pred_hc_eucl_comp <span class="ot">&lt;-</span> <span class="fu">as.factor</span>(df_labels<span class="sc">$</span>class_pred_hc_eucl_comp)</span>
<span id="cb20-6"><a href="#cb20-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-7"><a href="#cb20-7" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(df_labels)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>      class BrdIndx Area Round Bright Compact ShpIndx Mean_G Mean_R Mean_NIR
1      car     1.27   91  0.97 231.38    1.39    1.47 207.92 241.74   244.48
2 concrete     2.36  241  1.56 216.15    2.46    2.51 187.85 229.39   231.20
3 concrete     2.12  266  1.47 232.18    2.07    2.21 206.54 244.22   245.79
4 concrete     2.42  399  1.28 230.40    2.49    2.73 204.60 243.27   243.32
5 concrete     2.15  944  1.73 193.18    2.28    4.10 165.98 205.55   208.00
6     tree     3.11  169  1.47 172.22    2.49    3.35 240.18 127.65   148.83
   SD_G  SD_R SD_NIR    LW GLCM1 Rect GLCM2 Dens Assym  NDVI BordLngth   GLCM3
1 21.41 20.40  18.69  2.19  0.48 0.87  6.23 1.60  0.74 -0.08        56 4219.69
2  6.57  6.97   7.02  1.52  0.45 0.63  6.35 1.55  0.69 -0.10       156 3682.08
3  6.16  4.93   5.53  1.14  0.52 0.78  6.19 1.88  0.19 -0.08       144 2943.35
4  5.76  5.56   5.46  2.51  0.50 0.74  6.28 1.51  0.83 -0.09       218 3550.19
5 11.46  8.90   9.77 12.26  0.71 0.59  7.36 0.63  0.99 -0.11       504 2300.41
6  8.41 10.34  11.50  1.87  0.43 0.55  6.44 1.38  0.70  0.31       174 4707.12
  BrdIndx_40 Area_40 Round_40 Bright_40 Compact_40 ShpIndx_40 Mean_G_40
1       1.33      97     1.12    227.19       1.32       1.42    203.95
2       3.01    1188     1.45    209.44       2.25       3.54    181.91
3       2.32    1095     1.50    232.50       1.93       2.55    208.36
4       3.16    4009     2.28    231.57       3.48       3.47    204.77
5       2.15     944     1.73    193.18       2.28       4.10    165.98
6       3.25     747     1.55    161.30       2.53       3.33    228.44
  Mean_R_40 Mean_NIR_40 SD_G_40 SD_R_40 SD_NIR_40 LW_40 GLCM1_40 Rect_40
1    237.23      240.38   27.63   28.36     26.18  2.00     0.50    0.85
2    222.46      223.95    9.82   10.37     10.51  2.97     0.63    0.65
3    244.07      245.08    6.55    7.01      6.83  2.19     0.49    0.74
4    245.17      244.76    9.55    9.35      9.34  2.27     0.63    0.62
5    205.55      208.00   11.46    8.90      9.77 12.26     0.71    0.59
6    117.25      138.20   16.32   14.66     15.47  1.02     0.74    0.69
  GLCM2_40 Dens_40 Assym_40 NDVI_40 BordLngth_40 GLCM3_40 BrdIndx_60 Area_60
1     6.29    1.67     0.70   -0.08           56  3806.36       1.33      97
2     7.16    1.43     0.83   -0.10          488  2581.63       4.53    3861
3     6.51    1.61     0.81   -0.08          338  3087.91       2.05    4368
4     7.04    1.32     0.84   -0.09          878  2194.40       3.26    4834
5     7.36    0.63     0.99   -0.11          504  2300.41       2.08    3026
6     7.54    1.81     0.55    0.32          364  1764.09       1.88    1318
  Round_60 Bright_60 Compact_60 ShpIndx_60 Mean_G_60 Mean_R_60 Mean_NIR_60
1     1.12    227.19       1.32       1.42    203.95    237.23      240.38
2     1.96    207.24       3.00       4.70    180.61    219.54      221.58
3     1.27    224.42       1.98       2.22    202.85    234.48      235.94
4     2.04    231.28       2.89       3.56    205.87    244.14      243.82
5     1.97    202.17       2.52       3.94    181.47    211.90      213.15
6     1.00    162.91       1.93       1.91    224.17    121.94      142.62
  SD_G_60 SD_R_60 SD_NIR_60 LW_60 GLCM1_60 Rect_60 GLCM2_60 Dens_60 Assym_60
1   27.63   28.36     26.18  2.00     0.50    0.85     6.29    1.67     0.70
2   18.98   19.62     19.38  1.64     0.70    0.50     8.04    1.47     0.45
3   13.07   13.26     12.99  2.19     0.75    0.71     7.16    1.61     0.82
4   12.02   10.36     10.25  2.26     0.69    0.65     7.19    1.51     0.77
5   16.86   13.90     14.43 12.07     0.87    0.69     7.90    0.68     1.00
6   22.66   19.62     20.41  1.06     0.84    0.82     7.90    2.05     0.55
  NDVI_60 BordLngth_60 GLCM3_60 BrdIndx_80 Area_80 Round_80 Bright_80
1   -0.08           56  3806.36       1.33      97     1.12    227.19
2   -0.10         1168  1877.18       4.68    5544     1.93    205.53
3   -0.07          586  1245.19       2.05    4368     1.27    224.42
4   -0.09          990  1718.90       3.50    7622     1.91    232.09
5   -0.08          866   965.85       2.53    8862     2.10    196.33
6    0.30          278  1058.38       4.15    2517     1.97    161.02
  Compact_80 ShpIndx_80 Mean_G_80 Mean_R_80 Mean_NIR_80 SD_G_80 SD_R_80
1       1.32       1.42    203.95    237.23      240.38   27.63   28.36
2       3.17       5.12    178.89    217.71      220.01   18.86   19.94
3       1.98       2.22    202.85    234.48      235.94   13.07   13.26
4       2.83       4.19    205.48    245.53      245.26   10.44    9.36
5       2.89       6.57    180.56    203.81      204.62   16.01   16.50
6       2.88       4.39    222.03    120.40      140.62   23.37   22.87
  SD_NIR_80 LW_80 GLCM1_80 Rect_80 GLCM2_80 Dens_80 Assym_80 NDVI_80
1     26.18  2.00     0.50    0.85     6.29    1.67     0.70   -0.08
2     19.61  2.26     0.74    0.48     8.14    1.28     0.78   -0.10
3     12.99  2.19     0.75    0.71     7.16    1.61     0.82   -0.07
4      9.35  3.38     0.67    0.62     7.01    1.16     0.93   -0.09
5     17.48 24.83     0.84    0.59     7.97    0.43     1.00   -0.06
6     23.51  1.89     0.81    0.62     8.19    1.50     0.71    0.30
  BordLngth_80 GLCM3_80 BrdIndx_100 Area_100 Round_100 Bright_100 Compact_100
1           56  3806.36        1.33       97      1.12     227.19        1.32
2         1526  1757.87        4.68     5544      1.93     205.53        3.17
3          586  1245.19        1.93     4606      1.17     222.97        1.87
4         1464  1785.12        3.50     7622      1.91     232.09        2.83
5         2474  1130.22        2.53     8862      2.10     196.33        2.89
6          880  1333.10        3.05     4174      1.50     161.92        2.00
  ShpIndx_100 Mean_G_100 Mean_R_100 Mean_NIR_100 SD_G_100 SD_R_100 SD_NIR_100
1        1.42     203.95     237.23       240.38    27.63    28.36      26.18
2        5.12     178.89     217.71       220.01    18.86    19.94      19.61
3        2.08     201.51     232.96       234.43    15.35    15.93      15.59
4        4.19     205.48     245.53       245.26    10.44     9.36       9.35
5        6.57     180.56     203.81       204.62    16.01    16.50      17.48
6        3.35     222.62     121.92       141.23    29.25    26.42      26.38
  LW_100 GLCM1_100 Rect_100 GLCM2_100 Dens_100 Assym_100 NDVI_100 BordLngth_100
1   2.00      0.50     0.85      6.29     1.67      0.70    -0.08            56
2   2.26      0.74     0.48      8.14     1.28      0.78    -0.10          1526
3   2.19      0.76     0.74      7.24     1.68      0.81    -0.07           566
4   3.38      0.67     0.62      7.01     1.16      0.93    -0.09          1464
5  24.83      0.84     0.59      7.97     0.43      1.00    -0.06          2474
6   2.31      0.84     0.79      8.17     1.80      0.68     0.29           866
  GLCM3_100 BrdIndx_120 Area_120 Round_120 Bright_120 Compact_120 ShpIndx_120
1   3806.36        1.33       97      1.12     227.19        1.32        1.42
2   1757.87        4.57     7711      1.66     211.94        2.90        4.97
3   1094.04        1.93     4606      1.17     222.97        1.87        2.08
4   1785.12        2.41    10482      1.41     226.65        2.06        2.88
5   1130.22        3.34    16680      2.37     193.39        5.03       12.06
6    943.96        3.05     4174      1.50     161.92        2.00        3.35
  Mean_G_120 Mean_R_120 Mean_NIR_120 SD_G_120 SD_R_120 SD_NIR_120 LW_120
1     203.95     237.23       240.38    27.63    28.36      26.18   2.00
2     186.31     223.83       225.68    22.62    22.92      22.29   2.25
3     201.51     232.96       234.43    15.35    15.93      15.59   2.19
4     200.18     239.93       239.83    13.69    13.75      13.51   3.34
5     172.13     203.14       204.91    17.38    14.93      15.65  50.08
6     222.62     121.92       141.23    29.25    26.42      26.38   2.31
  GLCM1_120 Rect_120 GLCM2_120 Dens_120 Assym_120 NDVI_120 BordLngth_120
1      0.50     0.85      6.29     1.67      0.70    -0.08            56
2      0.79     0.55      8.42     1.38      0.81    -0.09          1746
3      0.76     0.74      7.24     1.68      0.81    -0.07           566
4      0.82     0.74      7.44     1.36      0.92    -0.09          1178
5      0.85     0.49      8.15     0.23      1.00    -0.08          6232
6      0.84     0.79      8.17     1.80      0.68     0.29           866
  GLCM3_120 BrdIndx_140 Area_140 Round_140 Bright_140 Compact_140 ShpIndx_140
1   3806.36        1.33       97      1.12     227.19        1.32        1.42
2   1450.14        4.57     7711      1.66     211.94        2.90        4.97
3   1094.04        1.93     4606      1.17     222.97        1.87        2.08
4   1125.38        2.41    10482      1.41     226.65        2.06        2.88
5   1146.38        3.34    16680      2.37     193.39        5.03       12.06
6    943.96        3.05     4174      1.50     161.92        2.00        3.35
  Mean_G_140 Mean_R_140 Mean_NIR_140 SD_G_140 SD_R_140 SD_NIR_140 LW_140
1     203.95     237.23       240.38    27.63    28.36      26.18   2.00
2     186.31     223.83       225.68    22.62    22.92      22.29   2.25
3     201.51     232.96       234.43    15.35    15.93      15.59   2.19
4     200.18     239.93       239.83    13.69    13.75      13.51   3.34
5     172.13     203.14       204.91    17.38    14.93      15.65  50.08
6     222.62     121.92       141.23    29.25    26.42      26.38   2.31
  GLCM1_140 Rect_140 GLCM2_140 Dens_140 Assym_140 NDVI_140 BordLngth_140
1      0.50     0.85      6.29     1.67      0.70    -0.08            56
2      0.79     0.55      8.42     1.38      0.81    -0.09          1746
3      0.76     0.74      7.24     1.68      0.81    -0.07           566
4      0.82     0.74      7.44     1.36      0.92    -0.09          1178
5      0.85     0.49      8.15     0.23      1.00    -0.08          6232
6      0.84     0.79      8.17     1.80      0.68     0.29           866
  GLCM3_140 cluster_hc_eucl_comp class_pred_hc_eucl_comp
1   3806.36                    1               building 
2   1450.14                    2               concrete 
3   1094.04                    2               concrete 
4   1125.38                    2               concrete 
5   1146.38                    3               concrete 
6    943.96                    4                  grass </code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="co"># confusion matrix</span></span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a><span class="co">#add factor level called 'tree', 'shadow', 'soil'</span></span>
<span id="cb22-4"><a href="#cb22-4" aria-hidden="true" tabindex="-1"></a><span class="fu">levels</span>(df_labels<span class="sc">$</span>class_pred_hc_eucl_comp) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="fu">levels</span>(df_labels<span class="sc">$</span>class_pred_hc_eucl_comp), <span class="st">'tree '</span>)</span>
<span id="cb22-5"><a href="#cb22-5" aria-hidden="true" tabindex="-1"></a><span class="fu">levels</span>(df_labels<span class="sc">$</span>class_pred_hc_eucl_comp) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="fu">levels</span>(df_labels<span class="sc">$</span>class_pred_hc_eucl_comp), <span class="st">'shadow '</span>)</span>
<span id="cb22-6"><a href="#cb22-6" aria-hidden="true" tabindex="-1"></a><span class="fu">levels</span>(df_labels<span class="sc">$</span>class_pred_hc_eucl_comp) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="fu">levels</span>(df_labels<span class="sc">$</span>class_pred_hc_eucl_comp), <span class="st">'soil '</span>)</span>
<span id="cb22-7"><a href="#cb22-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-8"><a href="#cb22-8" aria-hidden="true" tabindex="-1"></a><span class="fu">confusionMatrix</span>(df_labels<span class="sc">$</span>class, df_labels<span class="sc">$</span>class_pred_hc_eucl_comp)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning in confusionMatrix.default(df_labels$class,
df_labels$class_pred_hc_eucl_comp): Levels are not in the same order for
reference and data. Refactoring data to match.</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Confusion Matrix and Statistics

           Reference
Prediction  asphalt  building  car  concrete  grass  pool  tree  shadow  soil 
  asphalt         13         0    0         0      1     0     0       0     0
  building         1        18    0         1      5     0     0       0     0
  car              0         4    9         0      0     2     0       0     0
  concrete         0         2    0        21      0     0     0       0     0
  grass            2         1    0         5     21     0     0       0     0
  pool             0         1    0         0      1    13     0       0     0
  tree             0         0    0         1     16     0     0       0     0
  shadow          11         0    0         0      5     0     0       0     0
  soil             0         0    0        14      0     0     0       0     0

Overall Statistics
                                         
               Accuracy : 0.5655         
                 95% CI : (0.487, 0.6416)
    No Information Rate : 0.2917         
    P-Value [Acc &gt; NIR] : 1.351e-13      
                                         
                  Kappa : 0.4984         
                                         
 Mcnemar's Test P-Value : NA             

Statistics by Class:

                     Class: asphalt  Class: building  Class: car 
Sensitivity                  0.48148           0.6923     1.00000
Specificity                  0.99291           0.9507     0.96226
Pos Pred Value               0.92857           0.7200     0.60000
Neg Pred Value               0.90909           0.9441     1.00000
Prevalence                   0.16071           0.1548     0.05357
Detection Rate               0.07738           0.1071     0.05357
Detection Prevalence         0.08333           0.1488     0.08929
Balanced Accuracy            0.73719           0.8215     0.98113
                     Class: concrete  Class: grass  Class: pool  Class: tree 
Sensitivity                    0.5000        0.4286      0.86667           NA
Specificity                    0.9841        0.9328      0.98693       0.8988
Pos Pred Value                 0.9130        0.7241      0.86667           NA
Neg Pred Value                 0.8552        0.7986      0.98693           NA
Prevalence                     0.2500        0.2917      0.08929       0.0000
Detection Rate                 0.1250        0.1250      0.07738       0.0000
Detection Prevalence           0.1369        0.1726      0.08929       0.1012
Balanced Accuracy              0.7421        0.6807      0.92680           NA
                     Class: shadow  Class: soil 
Sensitivity                      NA           NA
Specificity                 0.90476      0.91667
Pos Pred Value                   NA           NA
Neg Pred Value                   NA           NA
Prevalence                  0.00000      0.00000
Detection Rate              0.00000      0.00000
Detection Prevalence        0.09524      0.08333
Balanced Accuracy                NA           NA</code></pre>
</div>
</div>
<p>The clustering mostly struggled with the distinction between {“tree”, “grass”}, and {“asphalt”, “shadow”}, and {concrete”, “soil”}, which makes sense given the similarities between these sets of classes, and the difficulty of this clustering task.</p>
</section>
<section id="internal-indices" class="level3">
<h3 class="anchored" data-anchor-id="internal-indices">Internal indices</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a><span class="co"># compute the silhouette coefficient</span></span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a><span class="fu">mean</span>(<span class="fu">silhouette</span>(<span class="fu">cutree</span>(result_hc_eucl_comp, <span class="dv">9</span>), distances_hc_eucl)[, <span class="dv">3</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.1625925</code></pre>
</div>
</div>
<p>The Silhouette coefficient is low, indicating that the clustering might be inaccuate, with overlapping clusters and points being misclassified. This has been shown above when we use external validity.</p>
</section>
</section>
</section>
<section id="sparse-hierarchical-clustering" class="level1">
<h1>sparse hierarchical clustering</h1>
<div class="cell">
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a><span class="co"># use pca to do dimension reduction</span></span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a>pca <span class="ot">&lt;-</span> <span class="fu">prcomp</span>(df_unsupervised,</span>
<span id="cb27-3"><a href="#cb27-3" aria-hidden="true" tabindex="-1"></a>                     <span class="at">center =</span> <span class="cn">TRUE</span>,</span>
<span id="cb27-4"><a href="#cb27-4" aria-hidden="true" tabindex="-1"></a>                     <span class="at">scale =</span> <span class="cn">TRUE</span>)</span>
<span id="cb27-5"><a href="#cb27-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-6"><a href="#cb27-6" aria-hidden="true" tabindex="-1"></a><span class="fu">screeplot</span>(pca, <span class="at">type =</span> <span class="st">'lines'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="02_report_code_files/figure-html/unnamed-chunk-13-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>Using 9 principal components would be sufficient to explain the variability in the data.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a><span class="co"># set the seed for reproducibility</span></span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">123</span>)</span>
<span id="cb28-3"><a href="#cb28-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-4"><a href="#cb28-4" aria-hidden="true" tabindex="-1"></a><span class="co"># use the first 9 principal components to run hierarchical clustering</span></span>
<span id="cb28-5"><a href="#cb28-5" aria-hidden="true" tabindex="-1"></a>distances <span class="ot">&lt;-</span> <span class="fu">dist</span>(pca<span class="sc">$</span>x[, <span class="dv">1</span><span class="sc">:</span><span class="dv">9</span>], <span class="at">method =</span> <span class="st">"euclidean"</span>)</span>
<span id="cb28-6"><a href="#cb28-6" aria-hidden="true" tabindex="-1"></a>result_pca <span class="ot">&lt;-</span> <span class="fu">hclust</span>(distances, <span class="at">method =</span> <span class="st">"complete"</span>)</span>
<span id="cb28-7"><a href="#cb28-7" aria-hidden="true" tabindex="-1"></a><span class="fu">ggdendrogram</span>(result_pca, <span class="at">labels =</span> <span class="cn">FALSE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="02_report_code_files/figure-html/unnamed-chunk-14-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a><span class="co"># save the clustering result as a factor</span></span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a>clus_pca <span class="ot">&lt;-</span> <span class="fu">as.factor</span>(<span class="fu">cutree</span>(result_pca, <span class="dv">9</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<section id="evaluating-cluster-results-1" class="level2">
<h2 class="anchored" data-anchor-id="evaluating-cluster-results-1">Evaluating cluster results</h2>
<section id="bootstrap-stability-1" class="level3">
<h3 class="anchored" data-anchor-id="bootstrap-stability-1">Bootstrap stability</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a>cboot_shc <span class="ot">&lt;-</span> <span class="fu">clusterboot</span>(pca<span class="sc">$</span>x[, <span class="dv">1</span><span class="sc">:</span><span class="dv">9</span>], <span class="at">clustermethod =</span> hclustCBI, <span class="at">method =</span> <span class="st">"complete"</span>, <span class="at">k =</span> <span class="dv">9</span>, <span class="at">seed =</span> <span class="dv">123</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>boot 1 
boot 2 
boot 3 
boot 4 
boot 5 
boot 6 
boot 7 
boot 8 
boot 9 
boot 10 
boot 11 
boot 12 
boot 13 
boot 14 
boot 15 
boot 16 
boot 17 
boot 18 
boot 19 
boot 20 
boot 21 
boot 22 
boot 23 
boot 24 
boot 25 
boot 26 
boot 27 
boot 28 
boot 29 
boot 30 
boot 31 
boot 32 
boot 33 
boot 34 
boot 35 
boot 36 
boot 37 
boot 38 
boot 39 
boot 40 
boot 41 
boot 42 
boot 43 
boot 44 
boot 45 
boot 46 
boot 47 
boot 48 
boot 49 
boot 50 
boot 51 
boot 52 
boot 53 
boot 54 
boot 55 
boot 56 
boot 57 
boot 58 
boot 59 
boot 60 
boot 61 
boot 62 
boot 63 
boot 64 
boot 65 
boot 66 
boot 67 
boot 68 
boot 69 
boot 70 
boot 71 
boot 72 
boot 73 
boot 74 
boot 75 
boot 76 
boot 77 
boot 78 
boot 79 
boot 80 
boot 81 
boot 82 
boot 83 
boot 84 
boot 85 
boot 86 
boot 87 
boot 88 
boot 89 
boot 90 
boot 91 
boot 92 
boot 93 
boot 94 
boot 95 
boot 96 
boot 97 
boot 98 
boot 99 
boot 100 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb32"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a><span class="co"># the vector of cluster stabilities</span></span>
<span id="cb32-2"><a href="#cb32-2" aria-hidden="true" tabindex="-1"></a>cboot_shc<span class="sc">$</span>bootmean</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.4275979 0.3260530 0.4949368 0.7206667 0.5855424 0.5114355 0.4366718
[8] 0.3945805 0.5340758</code></pre>
</div>
</div>
<p>Values close to 1 indicate stable clusters, so generally the stability here is worse than just using the hierarchical clustering, except for the 4th cluster.</p>
</section>
<section id="external-validity-1" class="level3">
<h3 class="anchored" data-anchor-id="external-validity-1">External validity</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb34"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a>df_labels<span class="sc">$</span>cluster_pca <span class="ot">&lt;-</span> clus_pca  <span class="co"># Add cluster assignments to the original dataset</span></span>
<span id="cb34-2"><a href="#cb34-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-3"><a href="#cb34-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Count the number of occurrences of each class within each cluster</span></span>
<span id="cb34-4"><a href="#cb34-4" aria-hidden="true" tabindex="-1"></a>cluster_pca_mapping <span class="ot">&lt;-</span> df_labels <span class="sc">%&gt;%</span></span>
<span id="cb34-5"><a href="#cb34-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(cluster_pca, class) <span class="sc">%&gt;%</span></span>
<span id="cb34-6"><a href="#cb34-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">count =</span> <span class="fu">n</span>(), <span class="at">.groups =</span> <span class="st">"drop"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb34-7"><a href="#cb34-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(cluster_pca, <span class="fu">desc</span>(count))  <span class="co"># Ensure sorting by most frequent class</span></span>
<span id="cb34-8"><a href="#cb34-8" aria-hidden="true" tabindex="-1"></a>cluster_pca_mapping</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 28 × 3
   cluster_pca class       count
   &lt;fct&gt;       &lt;fct&gt;       &lt;int&gt;
 1 1           "building "    14
 2 1           "car "          2
 3 1           "grass "        1
 4 1           "pool "         1
 5 2           "concrete "    14
 6 2           "soil "        11
 7 2           "building "     8
 8 2           "grass "        7
 9 2           "car "          1
10 3           "concrete "     3
# ℹ 18 more rows</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb36"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Select the most frequent class for each cluster</span></span>
<span id="cb36-2"><a href="#cb36-2" aria-hidden="true" tabindex="-1"></a>cluster_pca_lookup <span class="ot">&lt;-</span> cluster_pca_mapping <span class="sc">%&gt;%</span></span>
<span id="cb36-3"><a href="#cb36-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(cluster_pca) <span class="sc">%&gt;%</span></span>
<span id="cb36-4"><a href="#cb36-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(count <span class="sc">==</span> <span class="fu">max</span>(count)) <span class="sc">%&gt;%</span>  <span class="co"># Select the most frequent class</span></span>
<span id="cb36-5"><a href="#cb36-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span></span>
<span id="cb36-6"><a href="#cb36-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(cluster_pca, class)  <span class="co"># Keep only cluster-class mapping</span></span>
<span id="cb36-7"><a href="#cb36-7" aria-hidden="true" tabindex="-1"></a>cluster_pca_lookup</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 9 × 2
  cluster_pca class      
  &lt;fct&gt;       &lt;fct&gt;      
1 1           "building "
2 2           "concrete "
3 3           "concrete "
4 4           "grass "   
5 5           "pool "    
6 6           "asphalt " 
7 7           "shadow "  
8 8           "concrete "
9 9           "car "     </code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb38"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Join the mapping back to the original dataset</span></span>
<span id="cb38-2"><a href="#cb38-2" aria-hidden="true" tabindex="-1"></a>df_labels <span class="ot">&lt;-</span> df_labels <span class="sc">%&gt;%</span></span>
<span id="cb38-3"><a href="#cb38-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(cluster_pca_lookup, <span class="at">by =</span> <span class="st">"cluster_pca"</span>, , <span class="at">suffix =</span> <span class="fu">c</span>(<span class="st">""</span>, <span class="st">"_pred_pca"</span>))</span>
<span id="cb38-4"><a href="#cb38-4" aria-hidden="true" tabindex="-1"></a>df_labels<span class="sc">$</span>class <span class="ot">&lt;-</span> <span class="fu">as.factor</span>(df_labels<span class="sc">$</span>class)</span>
<span id="cb38-5"><a href="#cb38-5" aria-hidden="true" tabindex="-1"></a>df_labels<span class="sc">$</span>class_pred_pca <span class="ot">&lt;-</span> <span class="fu">as.factor</span>(df_labels<span class="sc">$</span>class_pred_pca)</span>
<span id="cb38-6"><a href="#cb38-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-7"><a href="#cb38-7" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(df_labels)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>      class BrdIndx Area Round Bright Compact ShpIndx Mean_G Mean_R Mean_NIR
1      car     1.27   91  0.97 231.38    1.39    1.47 207.92 241.74   244.48
2 concrete     2.36  241  1.56 216.15    2.46    2.51 187.85 229.39   231.20
3 concrete     2.12  266  1.47 232.18    2.07    2.21 206.54 244.22   245.79
4 concrete     2.42  399  1.28 230.40    2.49    2.73 204.60 243.27   243.32
5 concrete     2.15  944  1.73 193.18    2.28    4.10 165.98 205.55   208.00
6     tree     3.11  169  1.47 172.22    2.49    3.35 240.18 127.65   148.83
   SD_G  SD_R SD_NIR    LW GLCM1 Rect GLCM2 Dens Assym  NDVI BordLngth   GLCM3
1 21.41 20.40  18.69  2.19  0.48 0.87  6.23 1.60  0.74 -0.08        56 4219.69
2  6.57  6.97   7.02  1.52  0.45 0.63  6.35 1.55  0.69 -0.10       156 3682.08
3  6.16  4.93   5.53  1.14  0.52 0.78  6.19 1.88  0.19 -0.08       144 2943.35
4  5.76  5.56   5.46  2.51  0.50 0.74  6.28 1.51  0.83 -0.09       218 3550.19
5 11.46  8.90   9.77 12.26  0.71 0.59  7.36 0.63  0.99 -0.11       504 2300.41
6  8.41 10.34  11.50  1.87  0.43 0.55  6.44 1.38  0.70  0.31       174 4707.12
  BrdIndx_40 Area_40 Round_40 Bright_40 Compact_40 ShpIndx_40 Mean_G_40
1       1.33      97     1.12    227.19       1.32       1.42    203.95
2       3.01    1188     1.45    209.44       2.25       3.54    181.91
3       2.32    1095     1.50    232.50       1.93       2.55    208.36
4       3.16    4009     2.28    231.57       3.48       3.47    204.77
5       2.15     944     1.73    193.18       2.28       4.10    165.98
6       3.25     747     1.55    161.30       2.53       3.33    228.44
  Mean_R_40 Mean_NIR_40 SD_G_40 SD_R_40 SD_NIR_40 LW_40 GLCM1_40 Rect_40
1    237.23      240.38   27.63   28.36     26.18  2.00     0.50    0.85
2    222.46      223.95    9.82   10.37     10.51  2.97     0.63    0.65
3    244.07      245.08    6.55    7.01      6.83  2.19     0.49    0.74
4    245.17      244.76    9.55    9.35      9.34  2.27     0.63    0.62
5    205.55      208.00   11.46    8.90      9.77 12.26     0.71    0.59
6    117.25      138.20   16.32   14.66     15.47  1.02     0.74    0.69
  GLCM2_40 Dens_40 Assym_40 NDVI_40 BordLngth_40 GLCM3_40 BrdIndx_60 Area_60
1     6.29    1.67     0.70   -0.08           56  3806.36       1.33      97
2     7.16    1.43     0.83   -0.10          488  2581.63       4.53    3861
3     6.51    1.61     0.81   -0.08          338  3087.91       2.05    4368
4     7.04    1.32     0.84   -0.09          878  2194.40       3.26    4834
5     7.36    0.63     0.99   -0.11          504  2300.41       2.08    3026
6     7.54    1.81     0.55    0.32          364  1764.09       1.88    1318
  Round_60 Bright_60 Compact_60 ShpIndx_60 Mean_G_60 Mean_R_60 Mean_NIR_60
1     1.12    227.19       1.32       1.42    203.95    237.23      240.38
2     1.96    207.24       3.00       4.70    180.61    219.54      221.58
3     1.27    224.42       1.98       2.22    202.85    234.48      235.94
4     2.04    231.28       2.89       3.56    205.87    244.14      243.82
5     1.97    202.17       2.52       3.94    181.47    211.90      213.15
6     1.00    162.91       1.93       1.91    224.17    121.94      142.62
  SD_G_60 SD_R_60 SD_NIR_60 LW_60 GLCM1_60 Rect_60 GLCM2_60 Dens_60 Assym_60
1   27.63   28.36     26.18  2.00     0.50    0.85     6.29    1.67     0.70
2   18.98   19.62     19.38  1.64     0.70    0.50     8.04    1.47     0.45
3   13.07   13.26     12.99  2.19     0.75    0.71     7.16    1.61     0.82
4   12.02   10.36     10.25  2.26     0.69    0.65     7.19    1.51     0.77
5   16.86   13.90     14.43 12.07     0.87    0.69     7.90    0.68     1.00
6   22.66   19.62     20.41  1.06     0.84    0.82     7.90    2.05     0.55
  NDVI_60 BordLngth_60 GLCM3_60 BrdIndx_80 Area_80 Round_80 Bright_80
1   -0.08           56  3806.36       1.33      97     1.12    227.19
2   -0.10         1168  1877.18       4.68    5544     1.93    205.53
3   -0.07          586  1245.19       2.05    4368     1.27    224.42
4   -0.09          990  1718.90       3.50    7622     1.91    232.09
5   -0.08          866   965.85       2.53    8862     2.10    196.33
6    0.30          278  1058.38       4.15    2517     1.97    161.02
  Compact_80 ShpIndx_80 Mean_G_80 Mean_R_80 Mean_NIR_80 SD_G_80 SD_R_80
1       1.32       1.42    203.95    237.23      240.38   27.63   28.36
2       3.17       5.12    178.89    217.71      220.01   18.86   19.94
3       1.98       2.22    202.85    234.48      235.94   13.07   13.26
4       2.83       4.19    205.48    245.53      245.26   10.44    9.36
5       2.89       6.57    180.56    203.81      204.62   16.01   16.50
6       2.88       4.39    222.03    120.40      140.62   23.37   22.87
  SD_NIR_80 LW_80 GLCM1_80 Rect_80 GLCM2_80 Dens_80 Assym_80 NDVI_80
1     26.18  2.00     0.50    0.85     6.29    1.67     0.70   -0.08
2     19.61  2.26     0.74    0.48     8.14    1.28     0.78   -0.10
3     12.99  2.19     0.75    0.71     7.16    1.61     0.82   -0.07
4      9.35  3.38     0.67    0.62     7.01    1.16     0.93   -0.09
5     17.48 24.83     0.84    0.59     7.97    0.43     1.00   -0.06
6     23.51  1.89     0.81    0.62     8.19    1.50     0.71    0.30
  BordLngth_80 GLCM3_80 BrdIndx_100 Area_100 Round_100 Bright_100 Compact_100
1           56  3806.36        1.33       97      1.12     227.19        1.32
2         1526  1757.87        4.68     5544      1.93     205.53        3.17
3          586  1245.19        1.93     4606      1.17     222.97        1.87
4         1464  1785.12        3.50     7622      1.91     232.09        2.83
5         2474  1130.22        2.53     8862      2.10     196.33        2.89
6          880  1333.10        3.05     4174      1.50     161.92        2.00
  ShpIndx_100 Mean_G_100 Mean_R_100 Mean_NIR_100 SD_G_100 SD_R_100 SD_NIR_100
1        1.42     203.95     237.23       240.38    27.63    28.36      26.18
2        5.12     178.89     217.71       220.01    18.86    19.94      19.61
3        2.08     201.51     232.96       234.43    15.35    15.93      15.59
4        4.19     205.48     245.53       245.26    10.44     9.36       9.35
5        6.57     180.56     203.81       204.62    16.01    16.50      17.48
6        3.35     222.62     121.92       141.23    29.25    26.42      26.38
  LW_100 GLCM1_100 Rect_100 GLCM2_100 Dens_100 Assym_100 NDVI_100 BordLngth_100
1   2.00      0.50     0.85      6.29     1.67      0.70    -0.08            56
2   2.26      0.74     0.48      8.14     1.28      0.78    -0.10          1526
3   2.19      0.76     0.74      7.24     1.68      0.81    -0.07           566
4   3.38      0.67     0.62      7.01     1.16      0.93    -0.09          1464
5  24.83      0.84     0.59      7.97     0.43      1.00    -0.06          2474
6   2.31      0.84     0.79      8.17     1.80      0.68     0.29           866
  GLCM3_100 BrdIndx_120 Area_120 Round_120 Bright_120 Compact_120 ShpIndx_120
1   3806.36        1.33       97      1.12     227.19        1.32        1.42
2   1757.87        4.57     7711      1.66     211.94        2.90        4.97
3   1094.04        1.93     4606      1.17     222.97        1.87        2.08
4   1785.12        2.41    10482      1.41     226.65        2.06        2.88
5   1130.22        3.34    16680      2.37     193.39        5.03       12.06
6    943.96        3.05     4174      1.50     161.92        2.00        3.35
  Mean_G_120 Mean_R_120 Mean_NIR_120 SD_G_120 SD_R_120 SD_NIR_120 LW_120
1     203.95     237.23       240.38    27.63    28.36      26.18   2.00
2     186.31     223.83       225.68    22.62    22.92      22.29   2.25
3     201.51     232.96       234.43    15.35    15.93      15.59   2.19
4     200.18     239.93       239.83    13.69    13.75      13.51   3.34
5     172.13     203.14       204.91    17.38    14.93      15.65  50.08
6     222.62     121.92       141.23    29.25    26.42      26.38   2.31
  GLCM1_120 Rect_120 GLCM2_120 Dens_120 Assym_120 NDVI_120 BordLngth_120
1      0.50     0.85      6.29     1.67      0.70    -0.08            56
2      0.79     0.55      8.42     1.38      0.81    -0.09          1746
3      0.76     0.74      7.24     1.68      0.81    -0.07           566
4      0.82     0.74      7.44     1.36      0.92    -0.09          1178
5      0.85     0.49      8.15     0.23      1.00    -0.08          6232
6      0.84     0.79      8.17     1.80      0.68     0.29           866
  GLCM3_120 BrdIndx_140 Area_140 Round_140 Bright_140 Compact_140 ShpIndx_140
1   3806.36        1.33       97      1.12     227.19        1.32        1.42
2   1450.14        4.57     7711      1.66     211.94        2.90        4.97
3   1094.04        1.93     4606      1.17     222.97        1.87        2.08
4   1125.38        2.41    10482      1.41     226.65        2.06        2.88
5   1146.38        3.34    16680      2.37     193.39        5.03       12.06
6    943.96        3.05     4174      1.50     161.92        2.00        3.35
  Mean_G_140 Mean_R_140 Mean_NIR_140 SD_G_140 SD_R_140 SD_NIR_140 LW_140
1     203.95     237.23       240.38    27.63    28.36      26.18   2.00
2     186.31     223.83       225.68    22.62    22.92      22.29   2.25
3     201.51     232.96       234.43    15.35    15.93      15.59   2.19
4     200.18     239.93       239.83    13.69    13.75      13.51   3.34
5     172.13     203.14       204.91    17.38    14.93      15.65  50.08
6     222.62     121.92       141.23    29.25    26.42      26.38   2.31
  GLCM1_140 Rect_140 GLCM2_140 Dens_140 Assym_140 NDVI_140 BordLngth_140
1      0.50     0.85      6.29     1.67      0.70    -0.08            56
2      0.79     0.55      8.42     1.38      0.81    -0.09          1746
3      0.76     0.74      7.24     1.68      0.81    -0.07           566
4      0.82     0.74      7.44     1.36      0.92    -0.09          1178
5      0.85     0.49      8.15     0.23      1.00    -0.08          6232
6      0.84     0.79      8.17     1.80      0.68     0.29           866
  GLCM3_140 cluster_hc_eucl_comp class_pred_hc_eucl_comp cluster_pca
1   3806.36                    1               building            1
2   1450.14                    2               concrete            2
3   1094.04                    2               concrete            2
4   1125.38                    2               concrete            2
5   1146.38                    3               concrete            3
6    943.96                    4                  grass            4
  class_pred_pca
1      building 
2      concrete 
3      concrete 
4      concrete 
5      concrete 
6         grass </code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb40"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a><span class="co"># confusion matrix</span></span>
<span id="cb40-2"><a href="#cb40-2" aria-hidden="true" tabindex="-1"></a><span class="fu">confusionMatrix</span>(df_labels<span class="sc">$</span>class, df_labels<span class="sc">$</span>class_pred_pca)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Confusion Matrix and Statistics

           Reference
Prediction  asphalt  building  car  concrete  grass  pool  shadow  soil  tree 
  asphalt         10         0    0         0      4     0       0     0     0
  building         0        14    0         8      2     0       1     0     0
  car              0         2    4         1      0     8       0     0     0
  concrete         0         0    0        23      0     0       0     0     0
  grass            0         1    0         9     19     0       0     0     0
  pool             0         1    0         0      1    13       0     0     0
  shadow           2         0    0         0      7     0       7     0     0
  soil             0         0    0        14      0     0       0     0     0
  tree             0         0    0         1     16     0       0     0     0

Overall Statistics
                                          
               Accuracy : 0.5357          
                 95% CI : (0.4573, 0.6129)
    No Information Rate : 0.3333          
    P-Value [Acc &gt; NIR] : 5.472e-08       
                                          
                  Kappa : 0.4628          
                                          
 Mcnemar's Test P-Value : NA              

Statistics by Class:

                     Class: asphalt  Class: building  Class: car 
Sensitivity                  0.83333          0.77778     1.00000
Specificity                  0.97436          0.92667     0.93293
Pos Pred Value               0.71429          0.56000     0.26667
Neg Pred Value               0.98701          0.97203     1.00000
Prevalence                   0.07143          0.10714     0.02381
Detection Rate               0.05952          0.08333     0.02381
Detection Prevalence         0.08333          0.14881     0.08929
Balanced Accuracy            0.90385          0.85222     0.96646
                     Class: concrete  Class: grass  Class: pool  Class: shadow 
Sensitivity                    0.4107        0.3878      0.61905        0.87500
Specificity                    1.0000        0.9160      0.98639        0.94375
Pos Pred Value                 1.0000        0.6552      0.86667        0.43750
Neg Pred Value                 0.7724        0.7842      0.94771        0.99342
Prevalence                     0.3333        0.2917      0.12500        0.04762
Detection Rate                 0.1369        0.1131      0.07738        0.04167
Detection Prevalence           0.1369        0.1726      0.08929        0.09524
Balanced Accuracy              0.7054        0.6519      0.80272        0.90938
                     Class: soil  Class: tree 
Sensitivity                    NA           NA
Specificity               0.91667       0.8988
Pos Pred Value                 NA           NA
Neg Pred Value                 NA           NA
Prevalence                0.00000       0.0000
Detection Rate            0.00000       0.0000
Detection Prevalence      0.08333       0.1012
Balanced Accuracy              NA           NA</code></pre>
</div>
</div>
<p>The accuracy is also lower than that of plain hierarchical clustering.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb42"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb42-1"><a href="#cb42-1" aria-hidden="true" tabindex="-1"></a>p1 <span class="ot">&lt;-</span> pca<span class="sc">$</span>x[, <span class="dv">1</span><span class="sc">:</span><span class="dv">9</span>] <span class="sc">%&gt;%</span> </span>
<span id="cb42-2"><a href="#cb42-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> PC1, <span class="at">y =</span> PC2, <span class="at">col =</span> clus_pca)) <span class="sc">+</span> </span>
<span id="cb42-3"><a href="#cb42-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span> </span>
<span id="cb42-4"><a href="#cb42-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>()</span>
<span id="cb42-5"><a href="#cb42-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-6"><a href="#cb42-6" aria-hidden="true" tabindex="-1"></a>p2 <span class="ot">&lt;-</span> pca<span class="sc">$</span>x[, <span class="dv">1</span><span class="sc">:</span><span class="dv">9</span>] <span class="sc">%&gt;%</span> </span>
<span id="cb42-7"><a href="#cb42-7" aria-hidden="true" tabindex="-1"></a>  <span class="co"># filter(class %in% c("tree ", "grass ")) %&gt;%</span></span>
<span id="cb42-8"><a href="#cb42-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> PC1, <span class="at">y =</span> PC2, <span class="at">col =</span> <span class="fu">as.factor</span>(df<span class="sc">$</span>class))) <span class="sc">+</span></span>
<span id="cb42-9"><a href="#cb42-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">col =</span>  <span class="st">"class"</span>) <span class="sc">+</span></span>
<span id="cb42-10"><a href="#cb42-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span> </span>
<span id="cb42-11"><a href="#cb42-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>()</span>
<span id="cb42-12"><a href="#cb42-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-13"><a href="#cb42-13" aria-hidden="true" tabindex="-1"></a>p2 <span class="sc">+</span> p1</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="02_report_code_files/figure-html/unnamed-chunk-21-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb43"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb43-1"><a href="#cb43-1" aria-hidden="true" tabindex="-1"></a><span class="co"># examples of where the clusters are easily to be misclassified</span></span>
<span id="cb43-2"><a href="#cb43-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-3"><a href="#cb43-3" aria-hidden="true" tabindex="-1"></a>p3 <span class="ot">&lt;-</span> pca<span class="sc">$</span>x[<span class="fu">which</span>(df<span class="sc">$</span>class <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"tree "</span>, <span class="st">"grass "</span>)), <span class="dv">1</span><span class="sc">:</span><span class="dv">9</span>] <span class="sc">%&gt;%</span></span>
<span id="cb43-4"><a href="#cb43-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> PC1, <span class="at">y =</span> PC2, <span class="at">col =</span> <span class="fu">as.factor</span>(df<span class="sc">$</span>class[<span class="fu">which</span>(df<span class="sc">$</span>class <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"tree "</span>, <span class="st">"grass "</span>))]))) <span class="sc">+</span></span>
<span id="cb43-5"><a href="#cb43-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">col =</span>  <span class="st">"class"</span>) <span class="sc">+</span></span>
<span id="cb43-6"><a href="#cb43-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">limits =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">20</span>, <span class="dv">15</span>)) <span class="sc">+</span> </span>
<span id="cb43-7"><a href="#cb43-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">limits =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">20</span>, <span class="dv">15</span>)) <span class="sc">+</span> </span>
<span id="cb43-8"><a href="#cb43-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span> </span>
<span id="cb43-9"><a href="#cb43-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>()</span>
<span id="cb43-10"><a href="#cb43-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-11"><a href="#cb43-11" aria-hidden="true" tabindex="-1"></a>p4 <span class="ot">&lt;-</span> pca<span class="sc">$</span>x[<span class="fu">which</span>(df<span class="sc">$</span>class <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"soil "</span>, <span class="st">"concrete "</span>)), <span class="dv">1</span><span class="sc">:</span><span class="dv">9</span>] <span class="sc">%&gt;%</span></span>
<span id="cb43-12"><a href="#cb43-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> PC1, <span class="at">y =</span> PC2, <span class="at">col =</span> <span class="fu">as.factor</span>(df<span class="sc">$</span>class[<span class="fu">which</span>(df<span class="sc">$</span>class <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"soil "</span>, <span class="st">"concrete "</span>))]))) <span class="sc">+</span></span>
<span id="cb43-13"><a href="#cb43-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">col =</span>  <span class="st">"class"</span>) <span class="sc">+</span></span>
<span id="cb43-14"><a href="#cb43-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">limits =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">20</span>, <span class="dv">15</span>)) <span class="sc">+</span> </span>
<span id="cb43-15"><a href="#cb43-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">limits =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">20</span>, <span class="dv">15</span>)) <span class="sc">+</span> </span>
<span id="cb43-16"><a href="#cb43-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span> </span>
<span id="cb43-17"><a href="#cb43-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>()</span>
<span id="cb43-18"><a href="#cb43-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-19"><a href="#cb43-19" aria-hidden="true" tabindex="-1"></a>p3 <span class="sc">+</span> p4</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="02_report_code_files/figure-html/unnamed-chunk-22-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="internal-indices-1" class="level3">
<h3 class="anchored" data-anchor-id="internal-indices-1">Internal indices</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb44"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb44-1"><a href="#cb44-1" aria-hidden="true" tabindex="-1"></a><span class="co"># compute the silhouette coefficient</span></span>
<span id="cb44-2"><a href="#cb44-2" aria-hidden="true" tabindex="-1"></a><span class="fu">mean</span>(<span class="fu">silhouette</span>(<span class="fu">cutree</span>(result_pca, <span class="dv">9</span>), distances)[, <span class="dv">3</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.1963163</code></pre>
</div>
</div>
<p>The Silhouette coefficient is somewhat higher than that of the plain hierarchical clustering, which could due to that we were able to “identify” one more class, by giving a cluster the label “shadow”, which we weren’t able to do previously.</p>
</section>
</section>
</section>

</main>
<!-- /main column -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    // For code content inside modals, clipBoardJS needs to be initialized with a container option
    // TODO: Check when it could be a function (https://github.com/zenorocha/clipboard.js/issues/860)
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->




</body></html>